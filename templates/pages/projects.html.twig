{% extends 'base.html.twig' %}

{% block content %}
	<!-- Begin Page Content -->
	<div class="container-fluid">
		<!-- Page Heading -->
          <div class="d-sm-flex align-items-center justify-content-between mb-4">
            <header class="panel-heading"><h3><strong>Projects</strong></h3></header>
          </div>

          <div class="row">
		    <div class="row" style="margin: 0 0 15px 25px;">
		        <div class="btn-group" role="group" aria-label="Basic example">
		        	<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#create-project-modal">
		        		Create Project
		        	</button>
		        </div>
		    </div>
		    <div class="col-lg-12">
		    	<div id="submitMessage" class="card bg-success text-white shadow mb-2" style="display:none;">
                    <div class="card-body"></div>
                </div>
		        <section id="sectionProjects" class="panel">
		        
		        	{% include 'pages/projects/table_projects.html.twig' %}
		        </section>
		    </div>
		</div>
	</div>
	<!-- /.container-fluid -->
{% endblock %}

{% block modals %}
	{{ parent() }}
	
  	<!-- Create Project Modal-->
	{% include 'modals/project_create.html.twig' %}
	{% include 'modals/project_delete.html.twig' %}
{% endblock %}

{% block scripts %}
	{{ parent() }}
 <script type="text/javascript">
$(function()
{
	// Init Delete Form
	$( '#sectionProjects' ).on( 'click', '.btnDelete', function( e )
	{
		$( '#project_delete_projectId' ).val( $( this ).attr( 'data-projectId' ) );
	});

	$( '#sectionProjects' ).on( 'click', '.btnEdit', function( e )
	{
		$.ajax({
			type: "GET",
		 	url: "/projects/edit/" + $( this ).attr( 'data-projectId' ),
			success: function( response )
			{
				$( '#formProjectContainer' ).html( response );
			},
			error: function()
			{
				alert( "SYSTEM ERROR!!!" );
			}
		});
	});

	// Submit Delete Form
	$( '#btnDeleteProject' ).on( 'click', function( e )
	{
		var form	= $( '#formDeleteProject' );
		$.ajax({
			type: "POST",
		 	url: form.attr( 'action' ),
		 	data: form.serialize(),
		 	dataType: 'json',
			success: function( response )
			{
				form[0].reset();
				if ( response.status == 'error' ) {
					alert( "FORM ERROR!!!" );

				} else {
					$( '#delete-project-modal' ).modal( 'toggle' );
					
					$( '#submitMessage > div.card-body' ).html( 'Successfuly deleting project.' );
					$( '#submitMessage' ).show();
					$( '#sectionProjects' ).html( response.data );
				}
			},
			error: function()
			{
				alert( "SYSTEM ERROR!!!" );
			}
		});
	});
		
	$( '#create-project-modal' ).on( 'click', '#btnSaveProject', function( e )
	{
		
		var form	= $( '#formProject' );
		alert( form.attr( 'action' ) );
		$.ajax({
			type: "POST",
		 	url: form.attr( 'action' ),
		 	data: form.serialize(),
		 	dataType: 'json',
			success: function( response )
			{
				form[0].reset();
				if ( response.status == 'error' ) {
					var ul = $( '<ul>' );
					$.each( response.errors, function( key, value ) {
						ul.append(
    				        $( document.createElement( 'li' ) ).text( key + ': ' + value )
    				    );
					});
					
					$( '#errorMessage > div.card-body' ).html( ul );
					$( '#errorMessage' ).show();
				} else {
					$( '#create-project-modal' ).modal( 'toggle' );
					
					$( '#submitMessage > div.card-body' ).html( 'Successfuly adding project.' );
					$( '#submitMessage' ).show();
					$( '#sectionProjects' ).html( response.data );
				}
			},
			error: function()
			{
				alert( "SYSTEM ERROR!!!" );
			}
       });
	});
});
</script>
{% endblock %}

