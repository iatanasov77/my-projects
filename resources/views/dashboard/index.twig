{% extends "layout/index.twig" %}

{% block content %}
<div class="row">&nbsp;</div>

<div class="row">
	<section class="panel" style="padding: 5px 30px 5px 30px;">
		<a href="/info.php" target="__blank">Php Info</a> |
	</section>
</div>

<div class="row">
    <div class="col-lg-12">
        <section class="panel">
        	<header class="panel-heading">Projects</header>

        	<table class="table table-striped table-advance table-hover">
        		<thead>
        			<tr>
        				<th>Project</th>
        				<th>Actions</th>
        			</tr>
        		</thead>
        		<tbody>
        		{% for project in projects %}
        			<tr>
        				<td>{{ project.title }}</td>
        				<td width="300">
        					{%  if vs_project_exists( project ) %}Checkout{% else %}<a class="btnInstall" data-projectId="{{ project.id }}" href="javascript:void(0);">Checkout</a>{% endif %}
        					{%  if vs_project_installed( project ) %}Installed{% else %}<a class="btnInstall" data-projectId="{{ project.id }}" href="javascript:void(0);">Install</a>{% endif %}

        					<a class="btnOpen" data-projectId="{{ project.id }}" href="javascript:void(0);">Run</a>

        				</td>
        			</tr>
        		{% endfor %}
        		</tbody>
        	</table>
        </section>

{#         
		<section class="panel">
        	<header class="panel-heading">CLI Projects</header>

        	<table class="table table-striped table-advance table-hover">
        		<thead>
        			<tr>
        				<th>Project</th>
        				<th>Actions</th>
        			</tr>
        		</thead>
        		<tbody>
        		{% for project in projectsCli %}
        			<tr>
        				<td>{{ project.title }}</td>
        				<td>
        				    {%  if vs_project_exists( project ) %}
        						Installed
        				    {% else %}
        						<a class="btnInstall" data-projectId="{{ project.id }}" href="javascript:void(0);">Install</a>
        				    {% endif %}
        				</td>
        			</tr>
        		{% endfor %}
        		</tbody>
        	</table>
        </section>
#}
	</div>

{#
    <div class="col-lg-6">
    	<section class="panel">
        	<header class="panel-heading">Tools</header>
        	<table class="table table-striped table-advance table-hover">
        		<thead>
        			<tr>
        				<th>Tool</th>
        				<th>Open</th>
        			</tr>
        		</thead>
        		<tbody>
        		{% for tool in tools %}
        			<tr>
        				<td>{{ tool.title }}</td>
        				<td>
        					{%  if vs_tool_exists( tool ) %}
        						<a href="http://{{ tool.url }}" target="__blank">Open</a>
        				    {% else %}
        						<a href="/tool/{{ tool.id }}/install">Install</a>
        				    {% endif %}
        				</td>
        			</tr>
        		{% endfor %}
        		</tbody>
        	</table>
        </section>
    <div>
#}

<div>
{% endblock %}

{% block js %}
<script type="text/javascript">
	$( function() {
		var dialog;
			
		function installProject( projectId )
		{
			var url	= "project/" + projectId + "/install-console";

			$( '.dialog-body' ).load( url );
		}

		function openProject( projectId )
		{
			var url	= "project/" + projectId + "/repair";
			
			$.get( url, function( data ) 
			{
				 var projectWindow	= window.open( data.url, '_blank' );
				 projectWindow.focus();
			});
		}

		dialog = $( "#dialog-form" ).dialog( {
			autoOpen: false,
			height: 600,
			width: 600,
			modal: true,
			buttons: [
				{
    				text:	"Close",
    				click:	function()
    				{
    					dialog.dialog( "close" );
    				}
				}
			],
			close: function() {
				$( ".dialog-body" ).html( "" );
			}
		} );

		$( ".btnInstall" ).button().on( "click", function( event ) {
			event.preventDefault();
			dialog.dialog( "open" );
			installProject( $( this ).attr( "data-projectId" ) );
		} );

		$( ".btnOpen" ).button().on( "click", function( event ) {
			event.preventDefault();
			
			openProject( $( this ).attr( "data-projectId" ) );
		} );
	} );
</script>
{% endblock %}
